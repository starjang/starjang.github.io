<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <meta http-equiv="X-UA-Compatible" content="IE=edge" >
  <title>Listen</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="We live in this world when we love it.">
<meta property="og:type" content="website">
<meta property="og:title" content="Listen">
<meta property="og:url" content="http://starjang.github.io/index.html">
<meta property="og:site_name" content="Listen">
<meta property="og:description" content="We live in this world when we love it.">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Listen">
<meta name="twitter:description" content="We live in this world when we love it.">
  
    <link rel="alternative" href="/atom.xml" title="Listen" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link rel="stylesheet" href="/css/style.css" type="text/css">
</head>

<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img lazy-src="/images/default_avatar.jpg" class="js-avatar">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/">Listen</a></h1>
		</hgroup>

		
		<p class="header-subtitle">记忆，流年，始于笔尖，盛于心田。</p>
		

		
			<div class="switch-btn">
				<div class="icon">
					<div class="icon-ctn">
						<div class="icon-wrap icon-house" data-idx="0">
							<div class="birdhouse"></div>
							<div class="birdhouse_holes"></div>
						</div>
						<div class="icon-wrap icon-ribbon hide" data-idx="1">
							<div class="ribbon"></div>
						</div>
						
						
						<div class="icon-wrap icon-me hide" data-idx="3">
							<div class="user"></div>
							<div class="shoulder"></div>
						</div>
						
					</div>
					
				</div>
				<div class="tips-box hide">
					<div class="tips-arrow"></div>
					<ul class="tips-inner">
						<li>菜单</li>
						<li>标签</li>
						
						
						<li>关于我</li>
						
					</ul>
				</div>
			</div>
		

		<div class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/">主页</a></li>
				        
							<li><a href="/archives">所有文章</a></li>
				        
							<li><a href="/tags/随笔">随笔</a></li>
				        
						</ul>
					</nav>
					<nav class="header-nav">
						<div class="social">
							
								<a class="github" target="_blank" href="https://github.com/starjang" title="github">github</a>
					        
								<a class="weibo" target="_blank" href="http://weibo.com/starzhang" title="weibo">weibo</a>
					        
						</div>
					</nav>
				</section>
				
				
				<section class="switch-part switch-part2">
					<div class="widget tagcloud" id="js-tagcloud">
						<a href="/tags/AFNetworking/" style="font-size: 10px;">AFNetworking</a> <a href="/tags/Braintree/" style="font-size: 10px;">Braintree</a> <a href="/tags/Cloud-Message/" style="font-size: 10px;">Cloud Message</a> <a href="/tags/Facebook/" style="font-size: 10px;">Facebook</a> <a href="/tags/Firebase/" style="font-size: 13.33px;">Firebase</a> <a href="/tags/Flurry-Analytics/" style="font-size: 10px;">Flurry Analytics</a> <a href="/tags/Google/" style="font-size: 16.67px;">Google</a> <a href="/tags/HTTPS/" style="font-size: 10px;">HTTPS</a> <a href="/tags/Notification/" style="font-size: 10px;">Notification</a> <a href="/tags/S3/" style="font-size: 10px;">S3</a> <a href="/tags/Twitter/" style="font-size: 10px;">Twitter</a> <a href="/tags/iOS/" style="font-size: 20px;">iOS</a> <a href="/tags/云存储/" style="font-size: 10px;">云存储</a> <a href="/tags/云消息/" style="font-size: 10px;">云消息</a> <a href="/tags/亚马逊/" style="font-size: 10px;">亚马逊</a> <a href="/tags/双向认证/" style="font-size: 10px;">双向认证</a> <a href="/tags/境外支付/" style="font-size: 10px;">境外支付</a> <a href="/tags/应用统计/" style="font-size: 10px;">应用统计</a> <a href="/tags/推送通知/" style="font-size: 10px;">推送通知</a> <a href="/tags/第三方登录/" style="font-size: 10px;">第三方登录</a> <a href="/tags/统计/" style="font-size: 10px;">统计</a> <a href="/tags/自签证书/" style="font-size: 10px;">自签证书</a> <a href="/tags/随笔/" style="font-size: 13.33px;">随笔</a>
					</div>
				</section>
				
				
				

				
				
				<section class="switch-part switch-part3">
				
					<div id="js-aboutme">现职iOS软件开发，对科技充满兴趣。</div>
				</section>
				
			</div>
		</div>
	</header>				
</div>

    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"></div>
  		<h1 class="header-author js-mobile-header hide">Listen</h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
			
				<img lazy-src="/images/default_avatar.jpg" class="js-avatar">
			
			</div>
			<hgroup>
			  <h1 class="header-author">Listen</h1>
			</hgroup>
			
			<p class="header-subtitle">记忆，流年，始于笔尖，盛于心田。</p>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">主页</a></li>
		        
					<li><a href="/archives">所有文章</a></li>
		        
					<li><a href="/tags/随笔">随笔</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="https://github.com/starjang" title="github">github</a>
			        
						<a class="weibo" target="_blank" href="http://weibo.com/starzhang" title="weibo">weibo</a>
			        
				</div>
			</nav>
		</header>				
	</div>
</nav>

      <div class="body-wrap">
  
    <article id="post-Cloud Message(云消息)" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/06/12/Cloud Message(云消息)/" class="article-date">
  	<time datetime="2016-06-12T09:20:18.000Z" itemprop="datePublished">2016-06-12</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/06/12/Cloud Message(云消息)/">Google Firebase Cloud Message(云消息)</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><br></p>
<h2 id="u7B80_u4ECB"><a href="#u7B80_u4ECB" class="headerlink" title="简介"></a>简介</h2><p>Firebase Cloud Messaging (FCM) 是一个跨平台的消息解决方案，可以让你可靠地传递消息和通知。</p>
<p><br></p>
<h2 id="u914D_u7F6E_u8BC1_u4E66"><a href="#u914D_u7F6E_u8BC1_u4E66" class="headerlink" title="配置证书"></a>配置证书</h2><ol>
<li>打开Mac上的<code>钥匙串</code>，在<code>我的证书</code>一栏，将已安装好的与项目<code>Bundle Id</code>一致的<code>Production iOS Push Services</code>和<code>Development iOS Push Services</code>证书密钥导出，文件类型选为<code>p.12</code>类型，添加密码并保存。</li>
<li>进入<a href="https://console.firebase.google.com/project/project-7586055240392275378/settings/cloudmessaging" target="_blank" rel="external">Firebase控制中心</a>，点击<code>项目设置</code>下的<code>云消息传递</code>，将导出的证书上传。</li>
</ol>
<p><br></p>
<h2 id="u6574_u5408iOS_u5BA2_u6237_u7AEFSDK"><a href="#u6574_u5408iOS_u5BA2_u6237_u7AEFSDK" class="headerlink" title="整合iOS客户端SDK"></a>整合iOS客户端SDK</h2><ol>
<li><p>由于FCM SDK依赖Firebase Analytics中的部分类库，所以要先整合Firebase Analytics SDK(见：Firebase Analytics文档)。</p>
</li>
<li><p>从GitHub下载<a href="https://dl.google.com/firebase/sdk/ios/3_2_1/Firebase.zip" target="_blank" rel="external">FCM SDK</a>，并将SDK中的<code>Messaging</code>文件加入到项目。</p>
</li>
<li><p>在<code>AppDelegate.h</code>中的<code>didFinishLaunchingWithOptions:</code>方法里，添加代码如下。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[FIRApp configure];</span><br></pre></td></tr></table></figure>
<p><br></p>
</li>
</ol>
<h2 id="u4F7F_u7528iOS_u5BA2_u6237_u7AEFSDK"><a href="#u4F7F_u7528iOS_u5BA2_u6237_u7AEFSDK" class="headerlink" title="使用iOS客户端SDK"></a>使用iOS客户端SDK</h2><ol>
<li><p>接收消息。访问注册令牌。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// AppDelegate.m</span></span><br><span class="line">- (<span class="keyword">void</span>)tokenRefreshNotification:(NSNotification *)notification &#123;</span><br><span class="line">  NSString *refreshedToken = [[FIRInstanceID instanceID] token];</span><br><span class="line">  NSLog(@<span class="string">"InstanceID token: %@"</span>, refreshedToken);</span><br><span class="line">  [self connectToFcm];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)connectToFcm &#123;</span><br><span class="line">    [[FIRMessaging messaging] connectWithCompletion:^(NSError * _Nullable error) &#123;</span><br><span class="line">        <span class="keyword">if</span> (error != nil) &#123;</span><br><span class="line">            NSLog(@<span class="string">"Unable to connect to FCM. %@"</span>, error);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            NSLog(@<span class="string">"Connected to FCM."</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>接收和处理消息。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// AppDelegate.m</span></span><br><span class="line">- (<span class="keyword">void</span>)application:(UIApplication *)application didReceiveRemoteNotification:(NSDictionary *)userInfo</span><br><span class="line">    fetchCompletionHandler:(<span class="keyword">void</span> (^)(UIBackgroundFetchResult))completionHandler &#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 获取消息</span></span><br><span class="line">  NSLog(@<span class="string">"%@"</span>, userInfo);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>​</p>
</li>
<li><p>iOS端向FCM云端发送消息。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[[FIRMessaging message] sendMessage:(nonnull NSDictionary *)message</span><br><span class="line">                                to:(nonnull NSString *)receiver</span><br><span class="line">                     withMessageID:(nonnull NSString *)messageID</span><br><span class="line">                        timeToLive:(<span class="keyword">int64_t</span>)ttl;</span><br></pre></td></tr></table></figure>
<ul>
<li><code>to</code>：接收应用服务器的地址<code>SENDER_ID@gcm.googleapis.com</code>。</li>
<li><code>withMessageID</code>：唯一消息标识。</li>
<li><code>message</code>：消息字典。</li>
<li><code>timeToLive</code>：发送有效期。</li>
</ul>
<p>通过添加监听，监测消息是否发送成功。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)sendDataMessageFailure:(NSNotification *) notification &#123; </span><br><span class="line">  NSString *messageID = (NSString *) message.object ; </span><br><span class="line">&#125; </span><br><span class="line">- (<span class="keyword">void</span>)sendDataMessageSuccess:(NSNotification *) notification &#123; </span><br><span class="line">  NSString *messageID = (NSString *)message.object ; </span><br><span class="line">  NSDictionary *userInfo = message.userInfo ;  <span class="comment">//包含错误信息等</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>注：只有应用服务器实现了XMPP连接服务器协议，才能使用客户端发送消息。</p>
</blockquote>
</li>
<li><p>订阅主题。若要取消订阅，使用<code>unsubscribeFromTopic:topic</code>方法。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[[FIRMessaging messaging] subscribeToTopic:@<span class="string">"/topics/news"</span>];</span><br><span class="line">NSLog(@<span class="string">"Subscribed to news topic"</span>);</span><br></pre></td></tr></table></figure>
<p>接收和处理主题消息。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// AppDelegate.m</span></span><br><span class="line">- (<span class="keyword">void</span>)application:(UIApplication *)application didReceiveRemoteNotification:(NSDictionary *)userInfo</span><br><span class="line">    fetchCompletionHandler:(<span class="keyword">void</span> (^)(UIBackgroundFetchResult))completionHandler &#123;</span><br><span class="line">  <span class="comment">// 消息主体</span></span><br><span class="line">  NSLog(@<span class="string">"%@"</span>, userInfo);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><br></p>
</li>
</ol>
<h2 id="u670D_u52A1_u5668_u7AEF-HTTP_u534F_u8BAE"><a href="#u670D_u52A1_u5668_u7AEF-HTTP_u534F_u8BAE" class="headerlink" title="服务器端-HTTP协议"></a>服务器端-HTTP协议</h2><ol>
<li><p>服务器向客户端发送消息。FCM提供了两种连接服务器的协议：HTTP和XMPP。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// HTTP POST 请求</span></span><br><span class="line">https:<span class="comment">//fcm.googleapis.com/fcm/send</span></span><br><span class="line">Content-Type:application/json</span><br><span class="line">Authorization:key=AIzaSyZ-<span class="number">1u</span>..<span class="number">.0</span>GBYzPu7Udno5aA</span><br><span class="line"></span><br><span class="line">&#123; <span class="string">"data"</span>: &#123;</span><br><span class="line">    <span class="string">"score"</span>: <span class="string">"5x1"</span>,</span><br><span class="line">    <span class="string">"time"</span>: <span class="string">"15:10"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">"to"</span> : <span class="string">"bk3RNwTe3H0:CI2k_HHwgIpoDKCIZvvDMExUdFQ3P1..."</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>HTTP请求头必须包含：<code>Authorization:key=服务器密钥</code>和<code>Content-Type</code>。</li>
<li><code>Authorization:key=服务器密钥</code>。服务器密钥在Firebase控制中心 &gt; 项目设置 &gt; 云消息传递里获取。</li>
<li><code>Content-Type</code>：内容类型。<code>application/json</code>为JSON类型 。</li>
<li><code>data</code>：数据内容。</li>
<li><code>to</code>：指定接收人。</li>
</ul>
<blockquote>
<p>完整参数信息<a href="https://firebase.google.com/docs/cloud-messaging/http-server-ref#send-downstream" target="_blank" rel="external">详见</a>。</p>
<p>服务器需要打开的端口：5228，5229，5230。FCM通常用5228，但有时会用到5229和5230。</p>
</blockquote>
</li>
<li><p>从服务器向FCM云端发送主题消息。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">// HTTP POST 请求</span><br><span class="line">https://fcm.googleapis.com/fcm/send</span><br><span class="line">Content-Type:application/json</span><br><span class="line">Authorization:key=AIzaSyZ-1u...0GBYzPu7Udno5aA</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  "to": "/topics/foo-bar",</span><br><span class="line">  "data": &#123;</span><br><span class="line">    "message": "This is a Firebase Cloud Messaging Topic Message!",</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// XMPP 消息</span><br><span class="line">&lt;message id=""&gt;</span><br><span class="line">  &lt;gcm xmlns="google:mobile:data"&gt;</span><br><span class="line">  &#123;</span><br><span class="line">      "to": "/topics/foo-bar",</span><br><span class="line">      "message_id": "m-1366082849205" ,</span><br><span class="line">      "data": &#123;</span><br><span class="line">          "message":"This is a Firebase Cloud Messaging Topic Message!"</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  &lt;/gcm&gt;</span><br><span class="line">&lt;/message&gt;</span><br></pre></td></tr></table></figure>
<p>发送到订阅了”狗”或”猫”的设备。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">// HTTP POST 请求</span><br><span class="line">https://fcm.googleapis.com/fcm/send</span><br><span class="line">Content-Type:application/json</span><br><span class="line">Authorization:key=AIzaSyZ-1u...0GBYzPu7Udno5aA</span><br><span class="line">  </span><br><span class="line">&#123;</span><br><span class="line">  "condition": "'dogs' in topics || 'cats' in topics",</span><br><span class="line">  "data": &#123;</span><br><span class="line">    "message": "This is a Firebase Cloud Messaging Topic Message!",</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// XMPP 消息</span><br><span class="line">&lt;message id=""&gt;</span><br><span class="line">  &lt;gcm xmlns="google:mobile:data"&gt;</span><br><span class="line">  &#123;</span><br><span class="line">    "condition": "'dogs' in topics || 'cats' in topics",</span><br><span class="line">    "data": &#123;</span><br><span class="line">      "message": "This is a Firebase Cloud Messaging Topic Message!",</span><br><span class="line">     &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  &lt;/gcm&gt;</span><br><span class="line">&lt;/message&gt;</span><br></pre></td></tr></table></figure>
<p>响应格式。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Success example:</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"message_id"</span>: <span class="string">"10"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//failure example:</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"error"</span>: <span class="string">"TopicsMessageRateExceeded"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>从服务器发送主题消息到FCM服务器，从而实现将消息发送到单个设备或用户组。应用服务器设置<code>to</code>为<code>/topics/yourTopic</code>。要给多个主题发送消息，要设置<code>condition</code>条件表达式。</p>
<p>例如：’TopicA’ in topics &amp;&amp; (‘TopicB’ in topics || ‘TopicC’ in topics) </p>
<p>这些组合会收到消息：</p>
<ul>
<li>TopicA和TopicB</li>
<li>TopicA和TopicC</li>
</ul>
</blockquote>
</li>
<li><p>设备组消息。</p>
<p>将消息发送到一个设备组之前，必须：</p>
<ul>
<li>取得每个设备的注册令牌并添加到组中。</li>
<li>创建<code>notification_key</code>，通过映射一个特定群体(通常是用户)标记设备组。可以在应用程序服务器或Android客户端创建。</li>
</ul>
<p>设备组的基本管理：创建和删除组。添加或删除设备：通常是通过应用程序服务器执行。或者，Android客户端应用程序可以从客户端管理设备组。</p>
<p>创建设备组：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// HTTP POST 请求</span></span><br><span class="line">https:<span class="comment">//android.googleapis.com/gcm/notification</span></span><br><span class="line">Content-Type:application/json</span><br><span class="line">Authorization:key=API_KEY</span><br><span class="line">project_id:SENDER_ID</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">   <span class="string">"operation"</span>: <span class="string">"create"</span>,</span><br><span class="line">   <span class="string">"notification_key_name"</span>: <span class="string">"appUser-Chris"</span>,</span><br><span class="line">   <span class="string">"registration_ids"</span>: [<span class="string">"4"</span>, <span class="string">"8"</span>, <span class="string">"15"</span>, <span class="string">"16"</span>, <span class="string">"23"</span>, <span class="string">"42"</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><code>notification_key_name</code>是一个名字或标识符 (例如，它可以是一个用户名)，值唯一。 <code>notification_key_name</code>和 <code>notification_key</code>是唯一的一组注册标记。重要的是，<code>notification_key_name</code>对每个客户端应用程序唯一。</li>
</ul>
<p>从设备中添加和删除设备：</p>
<ul>
<li><code>operation</code>：设置<code>add</code>添加，设置<code>remove</code>删除。</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// HTTP POST 请求</span></span><br><span class="line">https:<span class="comment">//android.googleapis.com/gcm/notification</span></span><br><span class="line">Content-Type:application/json</span><br><span class="line">Authorization:key=API_KEY</span><br><span class="line">project_id:SENDER_ID</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">   <span class="string">"operation"</span>: <span class="string">"add"</span>,  <span class="comment">// 删除为 "remove"</span></span><br><span class="line">   <span class="string">"notification_key_name"</span>: <span class="string">"appUser-Chris"</span>,</span><br><span class="line">   <span class="string">"notification_key"</span>: <span class="string">"APA91bGHXQBB...9QgnYOEURwm0I3lmyqzk2TXQ"</span>,</span><br><span class="line">   <span class="string">"registration_ids"</span>: [<span class="string">"51"</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>创建，添加，删除设备请求成功返回<code>notification_key</code>：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">   <span class="string">"notification_key"</span>: <span class="string">"APA91bGHXQBB...9QgnYOEURwm0I3lmyqzk2TXQ"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>​</p>
</li>
<li><p>高级消息选项。</p>
<p>| 消息类型             | 使用方案                             | 如何发送                            |<br>| —————- | :——————————- | ——————————- |<br>| 通知(notification) | FCM的消息会自动显示在客户端上，通知一个预定义的用户。     | 设置<code>notification</code>键，有可选的数据。始终可覆盖。 |<br>| 数据(data)         | 客户端应用程序负责处理数据消息。数据消息只有自定义键 - 值对。 | 仅设置<code>data</code>键。可以是可覆盖或不可覆盖的。        |</p>
<blockquote>
<p>当应用在后台时，如果只发送包含自定义键值的消息，iOS设备上设置自定义键-值对的<code>data</code>键和设置<code>content_available</code> 为<code>true</code>。</p>
</blockquote>
<p>通知(notification)</p>
<ul>
<li>当应用程序在后台通知被传递到通知托盘。</li>
<li>应用程序在前台，消息在<code>didReceiveRemoteNotification:</code> 代理方法内处理。</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">"to"</span> : <span class="string">"bk3RNwTe3H0:CI2k_HHwgIpoDKCIZvvDMExUdFQ3P1..."</span>,    			<span class="string">"notification"</span> : &#123;</span><br><span class="line">      <span class="string">"body"</span> : <span class="string">"great match!"</span>,</span><br><span class="line">      <span class="string">"title"</span> : <span class="string">"Portugal vs. Denmark"</span>,</span><br><span class="line">      <span class="string">"icon"</span> : <span class="string">"myicon"</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>数据(data)</p>
<ul>
<li>只有当应用程序在前台运行，并已建立了FCM连接。</li>
<li>消息在<code>didReceiveRemoteNotification:</code> 代理方法内处理。</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">     <span class="string">"to"</span> : <span class="string">"bk3RNwTe3H0:CI2k_HHwgIpoDKCIZvvDMExUdFQ3P1..."</span>,</span><br><span class="line">     <span class="string">"data"</span> : &#123;</span><br><span class="line">     <span class="string">"Nick"</span> : <span class="string">"Mario"</span>,</span><br><span class="line">     <span class="string">"body"</span> : <span class="string">"great match!"</span>,</span><br><span class="line">     <span class="string">"Room"</span> : <span class="string">"PortugalVSDenmark"</span></span><br><span class="line">     &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>既有通知(notification)又有数据(data)</p>
<ul>
<li>应用在前台：应用程序收到通知消息，当用户点击该通知只处理数据消息。</li>
<li>应用在后台：应用程序接收整体消息对象。</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">     <span class="string">"to"</span> : <span class="string">"APA91bHun4MxP5egoKMwt2KZFBaFUH-1RYqx..."</span>,</span><br><span class="line">     <span class="string">"notification"</span> : &#123;</span><br><span class="line">       <span class="string">"body"</span> : <span class="string">"great match!"</span>,</span><br><span class="line">       <span class="string">"title"</span> : <span class="string">"Portugal vs. Denmark"</span>,</span><br><span class="line">       <span class="string">"icon"</span> : <span class="string">"myicon"</span></span><br><span class="line">     &#125;,</span><br><span class="line">     <span class="string">"data"</span> : &#123;</span><br><span class="line">       <span class="string">"Nick"</span> : <span class="string">"Mario"</span>,</span><br><span class="line">       <span class="string">"Room"</span> : <span class="string">"PortugalVSDenmark"</span></span><br><span class="line">     &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<p>​</p>
</li>
</ol>
<ol>
<li><p>可覆盖和不可覆盖消息。</p>
<p>| 类型   | 使用方案                                     | 如何发送                  |<br>| —- | —————————————- | ——————— |<br>| 不可覆盖 | 每个消息在客户端应用都是重要的，需要被传递的。                  | 除了通知消息，所有消息都是默认不可覆盖的。 |<br>| 可覆盖  | 当存在呈现一个较旧的，相关的消息无关的客户端应用程序的较新的消息，FCM替代旧的消息。例如：发送到同步，或过时的通知。 | 设置<code>collapse_key</code>参数。   |</p>
<p>​</p>
</li>
<li><p>设置消息的优先级。</p>
<ul>
<li>普通优先级：消息传递的默认优先级。普通优先级的消息不会打开一个睡眠的设备，消息的发送可能会被延迟，以节省电池。</li>
<li>高优先级： FCM试图立即唤醒一个睡眠的设备。例如即时消息，聊天或语音呼叫提示应用程序，一般需要打开网络连接，确保FCM将消息传递到设备。</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">"to"</span> : <span class="string">"bk3RNwTe3H0:CI2k_HHwgIpoDKCIZvvDMExUdFQ3P1..."</span>,</span><br><span class="line">  <span class="string">"priority"</span> : <span class="string">"normal"</span>,  <span class="comment">// 高优先级为"high"</span></span><br><span class="line">  <span class="string">"notification"</span> : &#123;</span><br><span class="line">    <span class="string">"body"</span> : <span class="string">"This week's edition is now available."</span>,</span><br><span class="line">    <span class="string">"title"</span> : <span class="string">"NewsMagazine.com"</span>,</span><br><span class="line">    <span class="string">"icon"</span> : <span class="string">"new"</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">"data"</span> : &#123;</span><br><span class="line">    <span class="string">"volume"</span> : <span class="string">"3.21.15"</span>,</span><br><span class="line">    <span class="string">"contents"</span> : <span class="string">"http://www.news-magazine.com/world-week/21659772"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>设置消息的生命周期。</p>
<p>可以使用<code>time_to_live</code>参数，指定一个消息的最大寿命。这个参数的值必须是从0到2419200秒的持续时间。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123; </span><br><span class="line">   <span class="string">"collapse_key"</span>  :  <span class="string">"demo"</span> , </span><br><span class="line">   <span class="string">"delay_while_idle"</span>  :  <span class="literal">true</span> , </span><br><span class="line">   <span class="string">"to"</span>  :  <span class="string">"xyz"</span> , </span><br><span class="line">   <span class="string">"data"</span>  :  &#123; </span><br><span class="line">     <span class="string">"key1"</span>  :  <span class="string">"value1"</span> , </span><br><span class="line">     <span class="string">"key2"</span>  :  <span class="string">"value2"</span> , </span><br><span class="line">   &#125;, </span><br><span class="line">   <span class="string">"time_to_live"</span>  :  <span class="number">3</span> </span><br><span class="line"> &#125;,</span><br></pre></td></tr></table></figure>
<blockquote>
<p>目前，<code>time_to_live</code>不支持在iOS上的通知消息。</p>
</blockquote>
</li>
<li><p>响应格式。</p>
<ul>
<li>消息处理成功，HTTP响应200状态码。</li>
<li>FCM服务器拒绝请求，HTTP响应非200状态码。</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 响应格式示例</span></span><br><span class="line">&#123; <span class="string">"multicast_id"</span>: <span class="number">108</span>,</span><br><span class="line">  <span class="string">"success"</span>: <span class="number">1</span>,</span><br><span class="line">  <span class="string">"failure"</span>: <span class="number">0</span>,</span><br><span class="line">  <span class="string">"canonical_ids"</span>: <span class="number">0</span>,</span><br><span class="line">  <span class="string">"results"</span>: [</span><br><span class="line">    &#123; <span class="string">"message_id"</span>: <span class="string">"1:08"</span> &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><br></p>
</li>
</ol>
<h2 id="u670D_u52A1_u5668_u7AEF-XMPP_u534F_u8BAE"><a href="#u670D_u52A1_u5668_u7AEF-XMPP_u534F_u8BAE" class="headerlink" title="服务器端-XMPP协议"></a>服务器端-XMPP协议</h2><ol>
<li><p>创建连接。</p>
<ul>
<li>必须初始化Transport Layer Security (TLS)连接。需要注意的是CCS(Cloud Connection Server)目前不支持<a href="http://xmpp.org/rfcs/rfc3920.html" target="_blank" rel="external">STARTTLS extension</a>。</li>
<li>CCS需要SASL PLAIN认证机制，使用 <code>&lt;your_FCM_Sender_Id&gt; @ gcm.googleapis.com</code>（FCM <a href="https://firebase.google.com/docs/cloud-messaging/concept-options#senderid" target="_blank" rel="external">sender ID</a>）和服务器Key配置客户端应用程序。</li>
</ul>
<p>客户端</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;stream:stream to=<span class="string">"gcm.googleapis.com"</span></span><br><span class="line">        version=<span class="string">"1.0"</span> xmlns=<span class="string">"jabber:client"</span></span><br><span class="line">        xmlns:stream=<span class="string">"http://etherx.jabber.org/streams"</span>&gt;</span><br></pre></td></tr></table></figure>
<p>服务器</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;str:features xmlns:str="http://etherx.jabber.org/streams"&gt;</span><br><span class="line"> &lt;mechanisms xmlns="urn:ietf:params:xml:ns:xmpp-sasl"&gt;</span><br><span class="line">   &lt;mechanism&gt;X-OAUTH2&lt;/mechanism&gt;</span><br><span class="line">   &lt;mechanism&gt;X-GOOGLE-TOKEN&lt;/mechanism&gt;</span><br><span class="line">   &lt;mechanism&gt;PLAIN&lt;/mechanism&gt;</span><br><span class="line"> &lt;/mechanisms&gt;</span><br><span class="line">&lt;/str:features&gt;</span><br></pre></td></tr></table></figure>
<p>客户端</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;auth mechanism="PLAIN"</span><br><span class="line">xmlns="urn:ietf:params:xml:ns:xmpp-sasl"&gt;MTI2MjAwMzQ3OTMzQHByb2plY3RzLmdjbS5hb</span><br><span class="line">mFTeUIzcmNaTmtmbnFLZEZiOW1oekNCaVlwT1JEQTJKV1d0dw==&lt;/auth&gt;</span><br></pre></td></tr></table></figure>
<p>服务器</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;success xmlns=<span class="string">"urn:ietf:params:xml:ns:xmpp-sasl"</span>/&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>服务器向客户端发送消息。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">// XMPP 消息</span><br><span class="line">&lt;message id=""&gt;</span><br><span class="line">  &lt;gcm xmlns="google:mobile:data"&gt;</span><br><span class="line">    &#123; "data": &#123;</span><br><span class="line">      "score": "5x1",</span><br><span class="line">      "time": "15:10"</span><br><span class="line">    &#125;,</span><br><span class="line">    "to" : "bk3RNwTe3H0:CI2k_HHwgIpoDKCIZvvDMExUdFQ3P1..."</span><br><span class="line">  &#125;</span><br><span class="line">  &lt;/gcm&gt;</span><br><span class="line">&lt;/message&gt;</span><br></pre></td></tr></table></figure>
<p>XMPP协议和HTTP协议类似，除：</p>
<ul>
<li>不支持多个收件人。</li>
<li><code>to</code>是用来代替<code>registration_ids</code>。</li>
<li>CCS字段的<code>Message_ID</code>是必需的，是消息的唯一标识。CCS中ACK或NACK使用<code>Message_ID</code>识别从应用服务器发送到CCS的消息。</li>
</ul>
</li>
<li><p>请求格式。</p>
<p>发送同步消息</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;message id=""&gt;</span><br><span class="line">  &lt;gcm xmlns="google:mobile:data"&gt;</span><br><span class="line">  &#123;</span><br><span class="line">      "to":"REGISTRATION_ID",  // "to" replaces "registration_ids"</span><br><span class="line">  &#125;</span><br><span class="line">  &lt;/gcm&gt;</span><br><span class="line">&lt;/message&gt;</span><br></pre></td></tr></table></figure>
<p>通知(notification)类型</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;message id=""&gt;</span><br><span class="line">  &lt;gcm xmlns="google:mobile:data"&gt;</span><br><span class="line">  &#123;</span><br><span class="line">      "to":"REGISTRATION_ID",  // "to" replaces "registration_ids"</span><br><span class="line">     "notification": &#123;</span><br><span class="line">        "title": "Portugal vs. Denmark”,</span><br><span class="line">        "text”: "5 to 1”</span><br><span class="line">      &#125;,</span><br><span class="line">      "time_to_live":"600"</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">  &lt;/gcm&gt;</span><br><span class="line">&lt;/message&gt;</span><br></pre></td></tr></table></figure>
<p>数据(data)类型</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;message id=""&gt;</span><br><span class="line">  &lt;gcm xmlns="google:mobile:data"&gt;</span><br><span class="line">  &#123;</span><br><span class="line">      "to":"REGISTRATION_ID",  // "to" replaces "registration_ids"</span><br><span class="line">      "message_id":"m-1366082849205" // new required field</span><br><span class="line">      "data":</span><br><span class="line">      &#123;</span><br><span class="line">          "hello":"world",</span><br><span class="line">      &#125;</span><br><span class="line">      "time_to_live":"600",</span><br><span class="line">      "delay_while_idle": true/false,</span><br><span class="line">      "delivery_receipt_requested": true/false</span><br><span class="line">  &#125;</span><br><span class="line">  &lt;/gcm&gt;</span><br><span class="line">&lt;/message&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>响应格式。</p>
<p>一条CCS的回应可能有三种的形式。第一中是常规的”ACK”消息。但是，当该响应包含一个错误时，也可以获取到2种不同形式的消息。</p>
<p>ACK消息</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;message id=""&gt;</span><br><span class="line">  &lt;gcm xmlns="google:mobile:data"&gt;</span><br><span class="line">  &#123;</span><br><span class="line">      "from":"REGID",</span><br><span class="line">      "message_id":"m-1366082849205"</span><br><span class="line">      "message_type":"ack"</span><br><span class="line">  &#125;</span><br><span class="line">  &lt;/gcm&gt;</span><br><span class="line">&lt;/message&gt;</span><br></pre></td></tr></table></figure>
<p>NACK消息</p>
<p>当XMPP消息中的<code>message_type</code>状态是<code>NACK</code>时，这就是一个NACK消息。NACK消息包括：</p>
<ul>
<li>NACK错误代码。</li>
<li>NACK错误描述。</li>
</ul>
<p>例如：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;message&gt;</span><br><span class="line">  &lt;gcm xmlns="google:mobile:data"&gt;</span><br><span class="line">  &#123;</span><br><span class="line">    "message_type":"nack",</span><br><span class="line">    "message_id":"msgId1",</span><br><span class="line">    "from":"SomeInvalidRegistrationId",</span><br><span class="line">    "error":"BAD_REGISTRATION",</span><br><span class="line">    "error_description":"Invalid token on 'to' field: SomeInvalidRegistrationId"</span><br><span class="line">  &#125;</span><br><span class="line">  &lt;/gcm&gt;</span><br><span class="line">&lt;/message&gt;</span><br></pre></td></tr></table></figure>
<p>无效JSON</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;message&gt;</span><br><span class="line"> &lt;gcm xmlns="google:mobile:data"&gt;</span><br><span class="line"> &#123;</span><br><span class="line">   "message_type":"nack",</span><br><span class="line">   "message_id":"msgId1",</span><br><span class="line">   "from":"bk3RNwTe3H0:CI2k_HHwgIpoDKCIZvvDMExUdFQ3P1...",</span><br><span class="line">   "error":"INVALID_JSON",</span><br><span class="line">   "error_description":"InvalidJson: JSON_TYPE_ERROR : Field \"time_to_live\" must be a JSON java.lang.Number: abc"</span><br><span class="line"> &#125;</span><br><span class="line"> &lt;/gcm&gt;</span><br><span class="line">&lt;/message&gt;</span><br></pre></td></tr></table></figure>
<p>设备消息过载</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;message id="..."&gt;</span><br><span class="line">  &lt;gcm xmlns="google:mobile:data"&gt;</span><br><span class="line">  &#123;</span><br><span class="line">    "message_type":"nack",</span><br><span class="line">    "message_id":"msgId1",</span><br><span class="line">    "from":"REGID",</span><br><span class="line">    "error":"DEVICE_MESSAGE_RATE_EXCEEDED",</span><br><span class="line">    "error_description":"Downstream message rate exceeded for this registration id"</span><br><span class="line">  &#125;</span><br><span class="line">  &lt;/gcm&gt;</span><br><span class="line">&lt;/message&gt;</span><br></pre></td></tr></table></figure>
<p>节错误</p>
<p>在某些情况下会得到一个节错误。一个节错误包括：</p>
<ul>
<li>节错误代码。</li>
<li>节错误描述。</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;message id="3" type="error" to="123456789@gcm.googleapis.com/ABC"&gt;</span><br><span class="line">  &lt;gcm xmlns="google:mobile:data"&gt;</span><br><span class="line">     &#123;"random": "text"&#125;</span><br><span class="line">  &lt;/gcm&gt;</span><br><span class="line">  &lt;error code="400" type="modify"&gt;</span><br><span class="line">    &lt;bad-request xmlns="urn:ietf:params:xml:ns:xmpp-stanzas"/&gt;</span><br><span class="line">    &lt;text xmlns="urn:ietf:params:xml:ns:xmpp-stanzas"&gt;</span><br><span class="line">      InvalidJson: JSON_PARSING_ERROR : Missing Required Field: message_id\n</span><br><span class="line">    &lt;/text&gt;</span><br><span class="line">  &lt;/error&gt;</span><br><span class="line">&lt;/message&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>管理消息。</p>
<p>每隔一段时间，CCS需要关闭连接进行负载均衡。关闭连接之前，CCS发送<code>CONNECTION_DRAINING</code>消息以指示该连接正被耗尽并即将关闭。当收到<code>CONNECTION_DRAINING</code>消息，应该立即开始将消息发送到另一个CCS连接，打开一个新的连接。</p>
<p>该<code>CONNECTION_DRAINING</code>消息如下：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;message&gt;</span><br><span class="line">  &lt;data:gcm xmlns:data="google:mobile:data"&gt;</span><br><span class="line">  &#123;</span><br><span class="line">    "message_type":"control"</span><br><span class="line">    "control_type":"CONNECTION_DRAINING"</span><br><span class="line">  &#125;</span><br><span class="line">  &lt;/data:gcm&gt;</span><br><span class="line">&lt;/message&gt;</span><br></pre></td></tr></table></figure>
<p>接收回执</p>
<p>对于Android和Chrome客户端应用程序，当一个设备确认其收到CCS发送的消息后可以得到一份送达回执(iOS设备不支持)。要启用此功能，应用服务器发送到CCS消息必须包括字段<a href="https://firebase.google.com/docs/cloud-messaging/xmpp-server-ref#delivery_receipt" target="_blank" rel="external"><code>delivery_receipt_requested</code></a>并设置为 <code>true</code>。</p>
<p>例如：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;message id=""&gt;</span><br><span class="line">  &lt;gcm xmlns="google:mobile:data"&gt;</span><br><span class="line">  &#123;</span><br><span class="line">      "to":"REGISTRATION_ID",</span><br><span class="line">      "message_id":"m-1366082849205"</span><br><span class="line">      "data":</span><br><span class="line">      &#123;</span><br><span class="line">          "hello":"world",</span><br><span class="line">      &#125;</span><br><span class="line">      "time_to_live":"600",</span><br><span class="line">      "delay_while_idle": true,</span><br><span class="line">      "delivery_receipt_requested": true</span><br><span class="line">  &#125;</span><br><span class="line">  &lt;/gcm&gt;</span><br><span class="line">&lt;/message&gt;</span><br></pre></td></tr></table></figure>
<p>收到：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;message id=""&gt;</span><br><span class="line">  &lt;gcm xmlns="google:mobile:data"&gt;</span><br><span class="line">  &#123;</span><br><span class="line">      "category":"com.example.yourapp", // to know which app sent it</span><br><span class="line">      "data":</span><br><span class="line">      &#123;</span><br><span class="line">         “message_status":"MESSAGE_SENT_TO_DEVICE",</span><br><span class="line">         “original_message_id”:”m-1366082849205”</span><br><span class="line">         “device_registration_id”: “REGISTRATION_ID”</span><br><span class="line">      &#125;,</span><br><span class="line">      "message_id":"dr2:m-1366082849205",</span><br><span class="line">      "message_type":"receipt",</span><br><span class="line">      "from":"gcm.googleapis.com"</span><br><span class="line">  &#125;</span><br><span class="line">  &lt;/gcm&gt;</span><br><span class="line">&lt;/message&gt;</span><br></pre></td></tr></table></figure>
<p>请注意以下几点：</p>
<ul>
<li><code>message_type</code>被设定为<code>receipt</code>。</li>
<li><code>message_status</code>被设定为<code>MESSAGE_SENT_TO_DEVICE</code>，表示该设备接收到消息。注意，在这种情况下， <code>message_status</code>是<code>data</code>里的一部分。</li>
<li>收到的消息ID包含原始消息ID，但有一个 <code>DR2：</code>前缀。之后应用服务器必须发送一个带有此ID的ACK消息，ID在本例中是<code>DR2：M-1366082849205</code>。</li>
<li>原始消息ID，在<code>data</code>字段内。</li>
<li>如果CCS与设备之间的连接性较差，FCM消息会重复发送多次。</li>
</ul>
</li>
<li><p>控制流</p>
<p>每个消息发送到 CCS 都会收到一条 ACK 或 NACK 响应。尚未收到这些响应的消息会被视为挂起。如果挂起消息数量达到 100，应用程序服务器应该停止发送新消息和等待 CCS 处理现有挂起的消息。</p>
<p><img src="https://firebase.google.com/docs/cloud-messaging/images/CCS-ack.png" alt=""></p>
</li>
</ol>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Cloud-Message/">Cloud Message</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Firebase/">Firebase</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Google/">Google</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/iOS/">iOS</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/云消息/">云消息</a></li></ul>
	</div>

      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-Google Firebase Analytics(统计)" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/06/08/Google Firebase Analytics(统计)/" class="article-date">
  	<time datetime="2016-06-08T02:10:19.000Z" itemprop="datePublished">2016-06-08</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/06/08/Google Firebase Analytics(统计)/">Google Firebase Analytics(统计)</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="u7B80_u4ECB"><a href="#u7B80_u4ECB" class="headerlink" title="简介"></a>简介</h2><p>Google Firebase Analytics是移动应用统计分析平台，提供移动应用统计和分析流量来源、内容使用、用户属性和行为数据。</p>
      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Firebase/">Firebase</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Google/">Google</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/iOS/">iOS</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/统计/">统计</a></li></ul>
	</div>

      

      
        <p class="article-more-link">
          <a  href="/2016/06/08/Google Firebase Analytics(统计)/#more">more >></a>
        </p>
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-Firebase Notifications(推送通知)" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/06/07/Firebase Notifications(推送通知)/" class="article-date">
  	<time datetime="2016-06-07T09:05:00.000Z" itemprop="datePublished">2016-06-07</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/06/07/Firebase Notifications(推送通知)/">Google Firebase Notifications(推送通知)</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="u7B80_u4ECB"><a href="#u7B80_u4ECB" class="headerlink" title="简介"></a>简介</h2><p>Google Firebase Notifications 是一项免费为安卓和iOS开发者提供消息推送的服务。</p>
      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Google/">Google</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Notification/">Notification</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/iOS/">iOS</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/推送通知/">推送通知</a></li></ul>
	</div>

      

      
        <p class="article-more-link">
          <a  href="/2016/06/07/Firebase Notifications(推送通知)/#more">more >></a>
        </p>
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-AWS S3" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/06/07/AWS S3/" class="article-date">
  	<time datetime="2016-06-07T07:50:50.000Z" itemprop="datePublished">2016-06-07</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/06/07/AWS S3/">Amazon S3</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="u7B80_u8FF0S3"><a href="#u7B80_u8FF0S3" class="headerlink" title="简述S3"></a>简述S3</h2><p>Amazon S3 是 Internet 数据的存储库。Amazon S3 提供了可靠、快速和廉价的数据存储基础设施。它的目的是通过支持您随时从 Amazon EC2 内部或从网络上的任何地方存储和检索任何数量的数据来简化整个网络计算。Amazon S3 以冗余方式跨多个设施在多个设备上存储数据元，允许多个不同的客户端或应用程序线程同时对这些数据元进行读或写操作。您可以使用存储在 Amazon S3 中的冗余数据快速、可靠地恢复实例或应用程序故障。有关更多信息，请参阅 <a href="http://docs.aws.amazon.com/zh_cn/AWSEC2/latest/UserGuide/AmazonS3.html">Amazon Simple Storage Service (Amazon S3)</a>。  </p>
      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/S3/">S3</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/iOS/">iOS</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/云存储/">云存储</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/亚马逊/">亚马逊</a></li></ul>
	</div>

      

      
        <p class="article-more-link">
          <a  href="/2016/06/07/AWS S3/#more">more >></a>
        </p>
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-Flurry Analytics集成文档" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/06/01/Flurry Analytics集成文档/" class="article-date">
  	<time datetime="2016-05-31T18:50:50.000Z" itemprop="datePublished">2016-06-01</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/06/01/Flurry Analytics集成文档/">Flurry Analytics 集成</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>作为移动应用统计分析领域里的标杆平台，Flurry拥有非常全面的功能，并不仅仅限于数据统计、分析功能，还提供App Circle广告、推广平台功能。可以说Flurry是目前最全面的移动应用统计分析产品，除了统计单个应用内的各类数据指标外，还可以提供跨应用之间的 转化统计等针对企业级用户的功能。单纯从移动应用的数据统计功能来看，Flurry也处于领先位置。其功能模块设置合理，分析维度全面，分析流程易于理解。</p>
      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Flurry-Analytics/">Flurry Analytics</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Google/">Google</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/iOS/">iOS</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/应用统计/">应用统计</a></li></ul>
	</div>

      

      
        <p class="article-more-link">
          <a  href="/2016/06/01/Flurry Analytics集成文档/#more">more >></a>
        </p>
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-第三方登录Tokens时效" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/06/01/第三方登录Tokens时效/" class="article-date">
  	<time datetime="2016-05-31T18:36:50.000Z" itemprop="datePublished">2016-06-01</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/06/01/第三方登录Tokens时效/">国外第三方登录Tokens时效</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h4 id="Facebook_u767B_u5F55"><a href="#Facebook_u767B_u5F55" class="headerlink" title="Facebook登录"></a><strong>Facebook登录</strong></h4><ol>
<li>Facebook SDK的Tokens有效期是60天。Tokens失效的原因有三种：(1)授权时间超过了60天。(2) 用户授权应用后，修改了账号密码。(3)用户在Account Setting界面的App中删除了授权的应用。</li>
<li>使用<code>+ (FBSDKAccessToken *)currentAccessToken;</code>方法检测Tokens是否可用。如果可用，使用<code>- (instancetype)initWithGraphPath:</code>方法直接获取用户信息。如果不可用，需要<code>- (void)logInWithReadPermissions:</code>方法重新授权后，获取用户信息。</li>
<li>当前Tokens未失效的情况下，可通过<code>+ (void)refreshCurrentAccessToken:</code>方法，可更新许可状态和延长Token过期时间。</li>
<li>如果使用的是iOS，Android或JavaScript SDK，SDK会进行处理确保到期之前令牌被刷新。使用SDK可获取60天有效的长期Tokens，当用户使用App请求Facebook的服务器时，Tokens每天会被刷新一次，如果没有请求，Tokens会在60天后失效，并且需要重新授权获得。</li>
</ol>
<blockquote>
<p>原文：Facebook’s official SDKs manage the lifetime of tokens for you. When using iOS, Android or our JavaScript SDK, the SDK will handle making sure that tokens are refreshed before they expire.</p>
<p>Native mobile apps using Facebook’s SDKs will get long-lived access tokens, good for about 60 days. These tokens will be refreshed once per day when the person using your app makes a request to Facebook’s servers. If no requests are made, the token will expire after about 60 days and the person will have to go through the login flow again to get a new token.</p>
</blockquote>
      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Facebook/">Facebook</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Google/">Google</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Twitter/">Twitter</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/iOS/">iOS</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/第三方登录/">第三方登录</a></li></ul>
	</div>

      

      
        <p class="article-more-link">
          <a  href="/2016/06/01/第三方登录Tokens时效/#more">more >></a>
        </p>
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-HTTPS双向认证" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/02/04/HTTPS双向认证/" class="article-date">
  	<time datetime="2016-02-04T00:36:50.000Z" itemprop="datePublished">2016-02-04</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/02/04/HTTPS双向认证/">HTTPS双向认证</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h4 id="u4E00_u3001_u76F8_u5173_u8BF4_u660E"><a href="#u4E00_u3001_u76F8_u5173_u8BF4_u660E" class="headerlink" title="一、相关说明"></a>一、相关说明</h4><blockquote>
<p>HTTPS（Secure Hypertext Transfer Protocol）安全超文本传输协议</p>
<p>它是一个安全通信通道，它基于HTTP开发，用于在客户计算机和服务器之间交换信息。它使用安全套接字层(SSL)进行信息交换，简单来说它是HTTP的安全版。</p>
</blockquote>
<ul>
<li><p>HTTP和HTTPS的区别</p>
<ul>
<li>https协议需要到CA申请证书。</li>
<li>http是超文本传输协议，信息是明文传输，https则是具有安全性的ssl加密传输协议。</li>
<li>http和https使用的是完全不同的连接方式，用的端口也不一样，前者是80，后者是443。</li>
<li>http的连接很简单，是无状态的；https协议是由SSL+HTTP协议构建的可进行加密传输、身份认证的网络协议，比http协议安全。</li>
</ul>
</li>
<li><p>SLL功能</p>
<ul>
<li><p>客户对服务器的身份认证:</p>
<p>SSL服务器允许客户的浏览器使用标准的公钥加密技术和一些可靠的认证中心（CA）的证书，来确认服务器的合法性。</p>
</li>
<li><p>服务器对客户的身份认证:</p>
<p>也可通过公钥技术和证书进行认证，也可通过用户名，password来认证。</p>
</li>
<li><p>建立服务器与客户之间安全的数据通道:</p>
<p>SSL要求客户与服务器之间的所有发送的数据都被发送端加密、接收端解密，同时还检查数据的完整性。</p>
<p>SSL协议位于TCP/IP协议与各种应用层协议之间，为数据通讯提供安全支持。SSL协议可分为两层：</p>
<p>SSL记录协议（SSL Record Protocol）：它建立在可靠的传输协议（如TCP）之上，为高层协议提供数据封装、压缩、加密等基本功能的支持。</p>
<p>SSL握手协议（SSL Handshake Protocol）：它建立在SSL记录协议之上，用于在实际的数据传输开始前，通讯双方进行身份认证、协商加密算法、交换加密密钥等。</p>
      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/AFNetworking/">AFNetworking</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/HTTPS/">HTTPS</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/iOS/">iOS</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/双向认证/">双向认证</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/自签证书/">自签证书</a></li></ul>
	</div>

      

      
        <p class="article-more-link">
          <a  href="/2016/02/04/HTTPS双向认证/#more">more >></a>
        </p>
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-书城随笔" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/01/31/书城随笔/" class="article-date">
  	<time datetime="2016-01-31T13:20:55.000Z" itemprop="datePublished">2016-01-31</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/01/31/书城随笔/">书城随笔</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>有段时间没有去书城了，确切的说有一段时间没有好好去读一本书了。无论如何，读书真的应该成为一种习惯。不过从事开发工作以来，看的文章都是技术类的，文学一类的就很少了。技术无止境，需要学习的太多了。互联网+，云经济，这些词汇都从一个概念，慢慢走近我们的生活了。其实，作为一名技术人员，最大的快乐莫过于学习掌握这些新兴的技术了。未来的路还很远，加油吧！</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/随笔/">随笔</a></li></ul>
	</div>

      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-Braintree集成指南" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/01/30/Braintree集成指南/" class="article-date">
  	<time datetime="2016-01-30T14:10:15.000Z" itemprop="datePublished">2016-01-30</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/01/30/Braintree集成指南/">Braintree集成指南</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="u4E3A_u4EC0_u4E48_u4F7F_u7528Braintree"><a href="#u4E3A_u4EC0_u4E48_u4F7F_u7528Braintree" class="headerlink" title="为什么使用Braintree"></a><strong>为什么使用Braintree</strong></h3><ul>
<li>集成简单</li>
<li>自定义UI</li>
<li>一键支付</li>
<li>多渠道支持等</li>
</ul>
<h3 id="u4F7F_u7528Braintree_u7684_u6761_u4EF6"><a href="#u4F7F_u7528Braintree_u7684_u6761_u4EF6" class="headerlink" title="使用Braintree的条件"></a><strong>使用Braintree的条件</strong></h3><ul>
<li>公司必须在Braintree服务地</li>
<li><p>必须有所在服务地的公司银行账号</p>
      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Braintree/">Braintree</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/境外支付/">境外支付</a></li></ul>
	</div>

      

      
        <p class="article-more-link">
          <a  href="/2016/01/30/Braintree集成指南/#more">more >></a>
        </p>
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-轻轻冒个泡" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/01/30/轻轻冒个泡/" class="article-date">
  	<time datetime="2016-01-30T08:10:59.000Z" itemprop="datePublished">2016-01-30</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/01/30/轻轻冒个泡/">轻轻冒个泡</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><img src="http://starjang.cn/images/default_avatar.jpg" alt="image"></p>
<p>轻轻冒个泡，问声大家好！之所以创建这个站点除了记录历程，也是想分享一些自己的内容。接下来的日子里，我会慢慢丰富这个小站。</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/随笔/">随笔</a></li></ul>
	</div>

      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
  
</div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2016 Listen
    	</div>
      	<div class="footer-right">
      		<a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/litten/hexo-theme-yilia" target="_blank">Yilia</a> by Litten
      	</div>
    </div>
  </div>
</footer>
    </div>
    
  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">


<script>
	var yiliaConfig = {
		fancybox: true,
		mathjax: true,
		animate: true,
		isHome: true,
		isPost: false,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false
	}
</script>
<script src="http://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js" type="text/javascript"></script>
<script src="/js/main.js" type="text/javascript"></script>






<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


  </div>
</body>
</html>